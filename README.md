# Умный Telegram-мониторинг тестов

Интеллектуальная система мониторинга и оперативного анализа тестирования с уведомлениями в Telegram.

## Что это делает

Система автоматически:
- Следит за результатами тестов
- Анализирует причины падений
- Выдает конкретные рекомендации
- Отправляет уведомления в Telegram
- Ведет историю для выявления системных проблем

## Установка

1. Установи зависимости:
```bash
pip install -r requirements.txt
```

2. Создай бота в Telegram:
   - Напиши @BotFather
   - Отправь `/newbot`
   - Сохрани полученный токен

3. Узнай свой Chat ID:
   - Напиши @userinfobot
   - Скопируй свой ID

4. Настрой конфигурацию в `config.py`:
```python
BOT_TOKEN = 'твой_токен_от_BotFather'
CHAT_ID = 'твой_chat_id'
```

## Запуск

### Режим 1: Демонстрация (без Telegram)
```bash
python demo.py
```
Покажет анализ последнего отчета в консоли.

### Режим 2: Непрерывный мониторинг
```bash
python monitor.py
```
Программа будет следить за папкой `test_reports` и автоматически анализировать новые отчеты.

### Режим 3: Анализ конкретного отчета
```bash
python monitor.py test_reports/report.json
```

### Режим 4: Интеграция с pytest
Добавь в команду запуска тестов:
```bash
pytest --json-report --json-report-file=test_reports/report.json && python monitor.py test_reports/report.json
```

## Команды бота

В Telegram боте доступны кнопки:
- **Последний отчет** — сводка за 24 часа
- **Топ проблем** — самые падающие тесты за неделю
- **Что проверить?** — общие рекомендации

## Как работает анализ

Система распознает типы ошибок:
- **Timeout** — превышение времени ожидания
- **Connection** — проблемы с подключением
- **Auth** — ошибки аутентификации
- **404** — ресурс не найден
- **500** — ошибки сервера
- **Assertion** — несоответствие ожиданий

Для каждой ошибки выдаются конкретные рекомендации.

## База данных

Все результаты сохраняются в SQLite (`test_history.db`):
- История всех прогонов
- Статистика падений
- Типы ошибок
- Временные метки

## Структура проекта

```
├── config.py          # Конфигурация
├── core.py            # Парсер, анализатор, БД (все в одном)
├── telegram_bot.py    # Telegram бот
├── monitor.py         # Мониторинг и главный файл
├── demo.py            # Демо без Telegram
└── requirements.txt   # Зависимости
```

## Пример уведомления

```
[ВНИМАНИЕ]

[FAIL] Упал тест: test_user_login

Диагноз: Превышено время ожидания ответа

Что проверить:
1. Проверь нагрузку на сервер
2. Убедись, что сервис доступен
3. Проверь стабильность сети
4. Увеличь таймаут в конфигурации теста

[!] Тест падал 2 раз за последние 7 дней
```

## Расширение

Добавь свои типы ошибок в `core.py` (в словарь ERROR_RECOMMENDATIONS):
```python
ERROR_RECOMMENDATIONS['твой_тип'] = {
    'keywords': ['ключевые', 'слова'],
    'diagnosis': 'Описание проблемы',
    'recommendations': ['Совет 1', 'Совет 2']
}
```

## Требования

- Python 3.8+
- Telegram аккаунт
- pytest (для генерации отчетов)
